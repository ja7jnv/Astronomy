# <2026-01-30 Fri 09:44>
* ログ機能のon/offをデコレータを使ってechoと共通化
* config.iniに初期値を格納する方式を採用
  config.iniは、設定値がすべてstring型で格納されるため型の扱いに注意が必要。
* arrow演算子の最も簡単なパターンを作成
  とりあえず、月ではOK。

# <2026-01-31 Sat 14:31>
* reformat関数をmatch-caseに書き換え
* arrow関数を修正中

# <2026-01-31 Sat 22:37>
* arrow関数での処理
  fromUTC()が"/"と"-"のパースを間違えていたので修正。
* Dateの代入で結果エコーがNoneになるバグを修正

# <2026-02-01 Sun 09:45>
* arrow処理で出力フォーマットの整列と南中情報を設定
天文台のデータと若干の誤差がある。要調査。
- 月齢が天文台より大きい値だが、月の入時刻で月齢を計算してる？
  ⇢ 正午の時刻で計算
  
# <2026-02-02 Mon 14:35>
* 月の状態表示を天文台に合わせる

# <2026-02-03 Tue 12:47>
* マイグレーション準備完了
詳細は、maigration.org を参照。

# <2026-02-03 Tue 17:50>
* 日付が変わると月の出／入／南中表示が--:--になるのを抑止
* 月の出入における月齢表示を天文台の基準に合わせて正午月齢にする

# <2026-02-04 Wed 17:48>
* Observer -> Observer の処理を追加
ObserverにChokai（鳥海山）のデータをデバッグ用に追加し、表示ロジックを作成。

# <2026-02-05 Thu 17:42>
今日は起動直後にfcitx-5の不具合対応で時間を要し大した進展なし。
* 惑星の処理で星座位置を学名（英語）から日本語へ変換

# <2026-02-06 Fri 17:45>
* 計算用クラスとフォーマットクラスを独立
calculation.py と formatter.py を作成。適用は未。interpreterからformat部分を削除。sso.pyに移管予定。

# <2026-02-06 Fri 21:56>
* calculation.py と formatter.py を適用するため、トピックブランチを作成

# <2026-02-07 Sat 17:09>
* arrow演算の見直し
普通の式として、値を返す仕様に変更。

# <2026-02-09 Mon 17:29>
* コード担当部分の分離
classes.pyのformat部分をformat.pyへ、format.pyの計算部分をcalculation.pyへ移動。

# <2026-02-09 Mon 22:18>
* 天体位置情報の一元化に向けた調査結果をコメントに記述

# <2026-02-10 Tue 15:56>
* 表示情報を一元管理に集約
共通処理を一箇所にまとめ、位置情報表示、出入りの情報表示を一元化した。

# <2026-02-10 Tue 22:39>
* マイナな修正と惑星表示の和文化。
惑星の情報を表示する際の惑星名を和文化した。

# <2026-02-11 Wed 08:24>
* Print関数の追加

# <2026-02-12 Thu 09:57>
* 16方位の表示を追加
北北東とかの16方位表示を追加し、環境変数Directionで切替える。

# <2026-02-12 Thu 10:01>
* formatterのレファクトリング終了
format関連のリファクトリングが完了したのでdevelopブランチに戻る。

# <2026-02-12 Thu 14:47>
* repl(sso.py)への戻り値を本来の値に修正
arrow演算の結果を文字列で返さずdict型の数値辞書で返す。

# <2026-02-12 Thu 22:32>
* BodyへのDate設定機能の追加作業中
BodyへのDate設定が有効にならない。
Bodyの名前を変数に使ってしまうと二度とBodyにアクセスできない。
* DONE Bodyの名前は予約語とし、設定値がある場合はarrow演算の引数に使うようにする
CLOSED: [2026-02-13 Fri 13:58]

# <2026-02-13 Fri 09:42>
* 環境変数の型チェックをしてなかったので追加
classes.pyのset_{attr}のメソッドにエラーチェックを追加。
* arrow演算子の右辺(日付)の処理を追加
* 負の数を許容

# <2026-02-13 Fri 16:47>
* デフォルトの観測日時とBody観測日時の初期化
コマンドの解釈毎にTime環境変数とarrow演算子の右辺(日付)の日付をリセットする。

# <2026-02-14 Sat 18:26>
* シンタックスハイライトの導入
prompt_toolkitでシンタックスハイライト、rich.consoleで出力の色付けを実施。
色の調整はTODO項目。

# <2026-02-14 Sat 21:58>
* プロンプトとイントロをカラー化
* rich.consoleの集約
classes.pyでインスタンス化し必要なモジュールでimportする形式に変更。

# <2026-02-15 Sun 18:37>
* 表示情報及び文字の微調整
単位記号の分離によるハイライトの調整、及び月の形を表示。

# <2026-02-16 Mon 17:13>
* 食の計算のためSSOEarthクラスの作成
* funccallのディスパッチをif文の羅列からmatch文に変更
* ログレベルの変更をlogging.getLogger().setLevel()に変更

# <2026-02-17 Tue 17:51>
* 月食のロジックを組込み
月食のロジックをclasses.pyのSSOEarthクラスに追加。

# <2026-02-18 Wed 17:38>
* 画面が上17行でスクロールする不具合を修正
session.prompt()にreserve_space_for_menu=0を追加。
他、月食ロジックに大気誤差を導入。月没も-1.2度に変更。

# <2026-02-19 Thu 17:27>
* 月食ロジックの見直し途中

# <2026-02-20 Fri 17:56>
* 月食の経過を表示するロジックを追加
修正中。日付がUTCのまま。始まりの時刻を早めて検索する必要あり。

# <2026-02-21 Sat 14:07>
* 月食の時刻が天文台と大差ない値になったので一旦fix
月食の時刻探索を２時間前からにすることで、
データが天文台とほぼ一致するレベルになった。

# <2026-02-21 Sat 17:17>
* 月食の食状態と高度情報を修正
食の状態を食分数値から判断。
高度情報を観測地の月の高度で計算しラジアンから度に変換。
